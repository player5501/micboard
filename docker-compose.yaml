version: '3.8'

services:
  micboard:
    build: .
    image: micboard
    container_name: micboard
    ports:
      - '8058:8058'
    volumes:
      # Mount config directory for persistence
      - ./config:/root/.local/share/micboard
      # Mount data files if they are meant to be editable
      - ./data.json:/app/data.json
      - ./dcid.json:/app/dcid.json
      - ./democonfig.json:/app/democonfig.json

  pco-api:
    image: ghcr.io/player5501/pco-cli:latest
    container_name: pco-api
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - PCO_APPLICATION_ID=${PCO_APPLICATION_ID}
      - PCO_SECRET=${PCO_SECRET}
      - MOCK_API=${MOCK_API:-false}
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
